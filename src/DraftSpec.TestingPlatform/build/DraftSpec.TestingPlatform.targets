<?xml version="1.0" encoding="utf-8"?>
<Project>
  <!-- Include all CSX files (specs and helpers) as content, copy to output -->
  <ItemGroup>
    <None Remove="**/*.csx" />
    <Content Include="**/*.csx" Exclude="**/bin/**;**/obj/**" CopyToOutputDirectory="PreserveNewest" />
  </ItemGroup>

  <!-- Generate entry point by copying template -->
  <Target Name="GenerateDraftSpecEntryPoint"
          BeforeTargets="BeforeCompile"
          Condition="'$(GenerateDraftSpecEntryPoint)' == 'true'">

    <PropertyGroup>
      <DraftSpecEntryPointDir>$(IntermediateOutputPath)generated/</DraftSpecEntryPointDir>
      <DraftSpecEntryPoint>$(DraftSpecEntryPointDir)DraftSpec.EntryPoint.g.cs</DraftSpecEntryPoint>
      <DraftSpecTemplateFile>$(MSBuildThisFileDirectory)EntryPoint.template.cs</DraftSpecTemplateFile>
    </PropertyGroup>

    <MakeDir Directories="$(DraftSpecEntryPointDir)" />

    <Copy SourceFiles="$(DraftSpecTemplateFile)"
          DestinationFiles="$(DraftSpecEntryPoint)"
          SkipUnchangedFiles="true" />

    <ItemGroup>
      <Compile Include="$(DraftSpecEntryPoint)" />
    </ItemGroup>
  </Target>
</Project>
